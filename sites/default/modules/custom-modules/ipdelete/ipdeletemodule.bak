<?php
/**
 * @file
 * Code for the IP Delete.
 */

function ipdelete_form_alter(&$form, &$form_state, $form_id) {
if($form_id == 'print_mail_form' ){
$form['#validate'][] = 'ipdelete_print_mail_form_validate';
}
 array_push($form['#submit'], 'ipdelete_submit');
}
function ipdelete_print_mail_form_validate(&$form, &$form_state, $form_id) {
if(!preg_match('/^[0-9a-zA-Z€&הצ\.\,\;\:\!\?\&\%\(\)\[\]\=\@[:space:]-]+$/i', $form_state['values']['fld_subject'])){
 form_set_error('fld_subject',t('Die Nachricht enth&auml;lt nicht erlaubte Zeichen.'));

}
if(!preg_match('/^[0-9a-zA-Z€&הצ\.\,\;\:\!\?\&\%\(\)\[\]\=\@[:space:]-]+$/i', $form_state['values']['txt_message'])){
 form_set_error('txt_message',t('Die Nachricht enth&auml;lt nicht erlaubte Zeichen.'));

}
}
function ipdelete_submit(&$form, &$form_state){
db_query("UPDATE watchdog SET hostname = '-'");
db_query("UPDATE sessions SET hostname = '-'");
db_query("UPDATE webform_submissions SET remote_addr = '-'");
}

function ipdelete_node_view_alter(&$build) {
db_query("UPDATE sessions SET hostname = '-'");
db_query("UPDATE webform_submissions SET remote_addr = '-'");
db_query("UPDATE webform_submissions SET remote_addr = '-'");
}
